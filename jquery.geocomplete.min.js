/**
 * jQuery Geocoding and Places Autocomplete Plugin - V 1.5.0
 *
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
!function(t,i,e,o){function s(i,e){this.options=t.extend(!0,{},n,e),this.input=i,this.$input=t(i),this._defaults=n,this._name="geocomplete",this.init()}var n={bounds:!0,country:null,map:!1,details:!1,detailsAttribute:"name",autoselect:!0,location:!1,mapOptions:{zoom:14,scrollwheel:!1,mapTypeId:"roadmap"},markerOptions:{draggable:!1},maxZoom:16,types:["geocode"],blur:!1},a="street_address route intersection political country administrative_area_level_1 administrative_area_level_2 administrative_area_level_3 colloquial_area locality sublocality neighborhood premise subpremise postal_code natural_feature airport park point_of_interest post_box street_number floor room lat lng viewport location formatted_address location_type bounds".split(" "),r="id url website vicinity reference name rating international_phone_number icon formatted_phone_number".split(" ");t.extend(s.prototype,{init:function(){this.initMap(),this.initMarker(),this.initGeocoder(),this.initDetails(),this.initLocation()},initMap:function(){if(this.options.map){if("function"==typeof this.options.map.setCenter)return void(this.map=this.options.map);this.map=new google.maps.Map(t(this.options.map)[0],this.options.mapOptions),google.maps.event.addListener(this.map,"click",t.proxy(this.mapClicked,this)),google.maps.event.addListener(this.map,"zoom_changed",t.proxy(this.mapZoomed,this))}},initMarker:function(){if(this.map){var i=t.extend(this.options.markerOptions,{map:this.map});i.disabled||(this.marker=new google.maps.Marker(i),google.maps.event.addListener(this.marker,"dragend",t.proxy(this.markerDragged,this)))}},initGeocoder:function(){var i={types:this.options.types,bounds:this.options.bounds===!0?null:this.options.bounds,componentRestrictions:this.options.componentRestrictions};this.options.country&&(i.componentRestrictions={country:this.options.country}),this.autocomplete=new google.maps.places.Autocomplete(this.input,i),this.geocoder=new google.maps.Geocoder,this.map&&this.options.bounds===!0&&this.autocomplete.bindTo("bounds",this.map),google.maps.event.addListener(this.autocomplete,"place_changed",t.proxy(this.placeChanged,this)),this.$input.keypress(function(t){return 13===t.keyCode?!1:void 0}),this.$input.bind("geocode",t.proxy(function(){this.find()},this)),this.options.blur===!0&&this.$input.blur(t.proxy(function(){this.find()},this))},initDetails:function(){function i(t){s[t]=e.find("["+o+"="+t+"]")}if(this.options.details){var e=t(this.options.details),o=this.options.detailsAttribute,s={};t.each(a,function(t,e){i(e),i(e+"_short")}),t.each(r,function(t,e){i(e)}),this.$details=e,this.details=s}},initLocation:function(){var t,i=this.options.location;if(i){if("string"==typeof i)return void this.find(i);i instanceof Array&&(t=new google.maps.LatLng(i[0],i[1])),i instanceof google.maps.LatLng&&(t=i),t&&(this.map&&this.map.setCenter(t),this.marker&&this.marker.setPosition(t))}},find:function(t){this.geocode({address:t||this.$input.val()})},geocode:function(i){this.options.bounds&&!i.bounds&&(i.bounds=this.options.bounds===!0?this.map&&this.map.getBounds():this.options.bounds),this.options.country&&(i.region=this.options.country),this.geocoder.geocode(i,t.proxy(this.handleGeocode,this))},selectFirstResult:function(){var i="";t(".pac-item-selected")[0]&&(i="-selected");var e=t(".pac-container .pac-item"+i+":first span:nth-child(2)").text(),o=t(".pac-container .pac-item"+i+":first span:nth-child(3)").text(),s=e;return o&&(s+=" - "+o),this.$input.val(s),s},handleGeocode:function(t,i){if(i===google.maps.GeocoderStatus.OK){var e=t[0];this.$input.val(e.formatted_address),this.update(e),t.length>1&&this.trigger("geocode:multiple",t)}else this.trigger("geocode:error",i)},trigger:function(t,i){this.$input.trigger(t,[i])},center:function(t){t.viewport?(this.map.fitBounds(t.viewport),this.map.getZoom()>this.options.maxZoom&&this.map.setZoom(this.options.maxZoom)):(this.map.setZoom(this.options.maxZoom),this.map.setCenter(t.location)),this.marker&&(this.marker.setPosition(t.location),this.marker.setAnimation(this.options.markerOptions.animation))},update:function(t){this.map&&this.center(t.geometry),this.$details&&this.fillDetails(t),this.trigger("geocode:result",t)},fillDetails:function(i){var e={},o=i.geometry,s=o.viewport,n=o.bounds;t.each(i.address_components,function(t,i){var o=i.types[0];e[o]=i.long_name,e[o+"_short"]=i.short_name}),t.each(r,function(t,o){e[o]=i[o]}),t.extend(e,{formatted_address:i.formatted_address,street_address:e.street_number+" "+e.route,location_type:o.location_type||"PLACES",viewport:s,bounds:n,location:o.location,lat:o.location.lat(),lng:o.location.lng()}),t.each(this.details,t.proxy(function(t,i){var o=e[t];this.setDetail(i,o)},this)),this.data=e},setDetail:function(t,i){i===o?i="":"function"==typeof i.toUrlValue&&(i=i.toUrlValue()),t.is(":input")?t.val(i):t.text(i)},markerDragged:function(t){this.trigger("geocode:dragged",t.latLng)},mapClicked:function(t){this.trigger("geocode:click",t.latLng)},mapZoomed:function(){this.trigger("geocode:zoom",this.map.getZoom())},resetMarker:function(){this.marker.setPosition(this.data.location),this.setDetail(this.details.lat,this.data.location.lat()),this.setDetail(this.details.lng,this.data.location.lng())},placeChanged:function(){var t=this.autocomplete.getPlace();if(t&&t.geometry)this.update(t);else if(this.options.autoselect){var i=this.selectFirstResult();this.find(i)}}}),t.fn.geocomplete=function(i){var e="plugin_geocomplete";if("string"==typeof i){var o=t(this).data(e)||t(this).geocomplete().data(e),n=o[i];return"function"==typeof n?(n.apply(o,Array.prototype.slice.call(arguments,1)),t(this)):(2==arguments.length&&(n=arguments[1]),n)}return this.each(function(){var o=t.data(this,e);o||(o=new s(this,i),t.data(this,e,o))})}}(jQuery,window,document);